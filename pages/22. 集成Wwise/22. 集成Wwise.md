
初始化Wwise

```c++
bool IntegrationDemo::InitWwise(AkOSChar* in_szErrorBuffer, unsigned int in_unErrorBufferCharCount)
{
    //
    // Create and initialize an instance of the default memory manager. Note
    // that you can override the default memory manager with your own. Refer
    // to the SDK documentation for more information.
    //

	AKRESULT res = AK::MemoryMgr::Init( &m_memSettings );
    if ( res != AK_Success )
    {
		__AK_OSCHAR_SNPRINTF( in_szErrorBuffer, in_unErrorBufferCharCount, AKTEXT("AK::MemoryMgr::Init() returned AKRESULT %d"), res );
        return false;
    }

	//
    // Create and initialize an instance of the default streaming manager. Note
    // that you can override the default streaming manager with your own. Refer
    // to the SDK documentation for more information.
    //

    // Customize the Stream Manager settings here.
    
    if ( !AK::StreamMgr::Create( m_stmSettings ) )
    {
		AKPLATFORM::SafeStrCpy( in_szErrorBuffer, AKTEXT( "AK::StreamMgr::Create() failed" ), in_unErrorBufferCharCount );
        return false;
    }
    
	// 
    // Create a streaming device with blocking low-level I/O handshaking.
    // Note that you can override the default low-level I/O module with your own. Refer
    // to the SDK documentation for more information.        
	//
    
    // CAkFilePackageLowLevelIOBlocking::Init() creates a streaming device
    // in the Stream Manager, and registers itself as the File Location Resolver.
	m_deviceSettings.bUseStreamCache = true;
	res = m_pLowLevelIO->Init( m_deviceSettings );
	if ( res != AK_Success )
	{
		__AK_OSCHAR_SNPRINTF( in_szErrorBuffer, in_unErrorBufferCharCount, AKTEXT("m_lowLevelIO.Init() returned AKRESULT %d"), res );
        return false;
    }

    //
    // Create the Sound Engine
    // Using default initialization parameters
    //
    
	res = AK::SoundEngine::Init( &m_initSettings, &m_platformInitSettings );
    if ( res != AK_Success )
    {
		__AK_OSCHAR_SNPRINTF( in_szErrorBuffer, in_unErrorBufferCharCount, AKTEXT("AK::SoundEngine::Init() returned AKRESULT %d"), res );
        return false;
    }

    //
    // Initialize the music engine
    // Using default initialization parameters
    //

	res = AK::MusicEngine::Init( &m_musicInit );
    if ( res != AK_Success )
    {
		__AK_OSCHAR_SNPRINTF( in_szErrorBuffer, in_unErrorBufferCharCount, AKTEXT("AK::MusicEngine::Init() returned AKRESULT %d"), res );
        return false;
    }

#if !defined AK_OPTIMIZED && !defined INTEGRATIONDEMO_DISABLECOMM
    //
    // Initialize communications (not in release build!)
    //
	AKPLATFORM::SafeStrCpy(m_commSettings.szAppNetworkName, "Integration Demo", AK_COMM_SETTINGS_MAX_STRING_SIZE);
	res = AK::Comm::Init(m_commSettings);
	if ( res != AK_Success )
	{
		__AK_OSCHAR_SNPRINTF( in_szErrorBuffer, in_unErrorBufferCharCount, AKTEXT("AK::Comm::Init() returned AKRESULT %d. Communication between the Wwise authoring application and the game will not be possible."), res );
	}
#endif // AK_OPTIMIZED	
   
	AkSpatialAudioInitSettings settings;
	
	res = AK::SpatialAudio::Init(settings);
	if (res != AK_Success)
	{
		__AK_OSCHAR_SNPRINTF(in_szErrorBuffer, in_unErrorBufferCharCount, AKTEXT("AK::SpatialAudio::Init() returned AKRESULT %d"), res);
		return false;
	}

	AK::SoundEngine::RegisterGameObj(LISTENER_ID, "Listener (Default)");
	AK::SoundEngine::SetDefaultListeners(&LISTENER_ID, 1);
		
	// For platforms with a read-only bank path, add a writable folder
	// to the list of base paths. IO will fallback on this path
	// when opening a file for writing fails.
#if defined(WRITABLE_PATH)
	m_pLowLevelIO->AddBasePath(WRITABLE_PATH);
#endif

	// Set the path to the SoundBank Files last.
	// The last base path is always the first queried for files.
	m_pLowLevelIO->SetBasePath(SOUND_BANK_PATH);

	// Set global language. Low-level I/O devices can use this string to find language-specific assets.
	if (AK::StreamMgr::SetCurrentLanguage(AKTEXT("English(US)")) != AK_Success)	
		return false;	

	AK::SoundEngine::RegisterResourceMonitorCallback(ResourceMonitorDataCallback);

    return true;
}
```

资源监视器回调

```c++
#define DATA_SUMMARY_REFRESH_COOLDOWN 7; // Refresh cooldown affecting the refresh rate of the resource monitor data summary

void IntegrationDemo::ResourceMonitorDataCallback(const AkResourceMonitorDataSummary * in_pdataSummary)
{
	static int ResourceMonitorUpdateCooldown = 0;
	if (ResourceMonitorUpdateCooldown <= 0)
	{
		IntegrationDemo::ResourceDataSummary = *in_pdataSummary;
		ResourceMonitorUpdateCooldown = DATA_SUMMARY_REFRESH_COOLDOWN;
	}
	else
		ResourceMonitorUpdateCooldown--;
}
```

加载初始化bank

```c++
AkBankID bankID;
if ( AK::SoundEngine::LoadBank( "Init.bnk", bankID ) != AK_Success )
{
    SetLoadFileErrorMessage( "Init.bnk" );
    return false;
}
```

加载实际用到的bank并注册GameObj

```c++
bool DemoRTPCCarEngine::Init()
{
	// Load the sound bank
	AkBankID bankID; // Not used
	if ( AK::SoundEngine::LoadBank( "Car.bnk", bankID ) != AK_Success )
	{
		SetLoadFileErrorMessage( "Car.bnk" );
		return false;
	}
	
	// Register the "Car" game object
	AK::SoundEngine::RegisterGameObj( GAME_OBJECT_CAR, "Car" );

	// Initialize the page
	m_bPlayingEngine = false;
	return Page::Init();
}
```

为了听到声音，需要一个Listener

```c++
AK::SoundEngine::RegisterGameObj(LISTENER_ID, "Listener (Default)");
AK::SoundEngine::SetDefaultListeners(&LISTENER_ID, 1);
```

PostEvent执行事件，播放声音。AK::EVENTS::STOP_ENGINE 这种EventID是生成bank的时候生成的。引擎用lua的话，需要生成一份lua的来使用，或者手动Copy过去。

```c++
void DemoRTPCCarEngine::PlayEngineButton_Pressed( void* in_pSender, ControlEvent* )
{
	ButtonControl* sender = (ButtonControl*)in_pSender;

	if ( m_bPlayingEngine )
	{
		sender->SetLabel( "Start Engine" );
		AK::SoundEngine::PostEvent( AK::EVENTS::STOP_ENGINE, GAME_OBJECT_CAR );
	}
	else
	{
		sender->SetLabel( "Stop Engine" );
		AK::SoundEngine::PostEvent( AK::EVENTS::PLAY_ENGINE, GAME_OBJECT_CAR );
	}

	m_bPlayingEngine = !m_bPlayingEngine;
}
```

也可以用字符串Event

```c++
AK::SoundEngine::PostEvent("Play_RecordableMusic", GAME_OBJECT_MUSIC);
```

改变Event参数

```c++
void DemoRTPCCarEngine::RPMNumeric_ValueChanged( void* in_pSender, ControlEvent* )
{
	NumericControl* sender = (NumericControl*)in_pSender;

	AK::SoundEngine::SetRTPCValue( AK::GAME_PARAMETERS::RPM, (AkRtpcValue)sender->GetValue(), GAME_OBJECT_CAR );
}
```

不设置3D坐标，那就是2D音效了，例如背景音乐。

3D音效 设置GameObj的3D坐标位置。

```c++
AkSoundPosition soundPos;
soundPos.Set(position, orientationFront, orientationTop);
AK::SoundEngine::SetPosition(GAME_OBJECT_FOOTSTEPS, soundPos);
```

停止一个GameObj上的所有音乐

```c++
AK::SoundEngine::StopAll(GAME_OBJECT_MUSIC);
```

释放

```c++
void DemoRTPCCarEngine::Release()
{
	// Unregister the Car game object
	AK::SoundEngine::UnregisterGameObj( GAME_OBJECT_CAR );

	// Unload the soundbank
	AK::SoundEngine::UnloadBank( "Car.bnk", NULL );

	// Release the page
	Page::Release();
}
```