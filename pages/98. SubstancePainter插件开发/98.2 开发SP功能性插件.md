## 98.2 开发SP功能性插件

下面通过SP官网的自定义导出插件例子，来入门功能性插件开发，官网地址：

    https://substance3d.adobe.com/documentation/spdoc/creating-a-python-plugin-197427756.html

插件启用后，在`File`菜单下，增加了子菜单`Custom Python Export`，点击触发我们编写的自定义导出代码。

### 1.创建插件代码文件

新建插件代码文件`custom_export.py`，拷贝下面代码：

```python
import os

# 导入sp的模块
import substance_painter.ui
import substance_painter.export
import substance_painter.project
import substance_painter.textureset

# PySide 是Qt的封装，用来做UI
from PySide2 import QtWidgets


plugin_widgets = []


def export_textures() :
	# 检查是否打开了项目
	if not substance_painter.project.is_open() :
		return

	# 获取当前激活的绘画Layer
	stack = substance_painter.textureset.get_active_stack()

	# 获取当前激活的绘画Layer的TextureSet
	material = stack.material()

	# Build Export Preset resource URL
	export_preset = substance_painter.resource.ResourceID(
						context="allegorithmic",
						name="PBR Metallic Roughness" )

	print( "Preset:" )
	print( export_preset.url() )

	# Setup the export settings
	resolution = material.get_resolution()
	
	# Setup the export path, in this case the textures
	# will be put next to the spp project file on the disk
	Path = substance_painter.project.file_path()
	Path = os.path.dirname(Path) + "/"

	# Build the configuration
	config = {
		"exportShaderParams" 	: False,
		"exportPath" 			: Path,
		"exportList"			: [ { "rootPath" : str(stack) } ],
		"exportPresets" 		: [ { "name" : "default", "maps" : [] } ],
		"defaultExportPreset" 	: export_preset.url(),
		"exportParameters" 		: [
			{
				"parameters"	: { "paddingAlgorithm": "infinite" }
			}
		]
	}

	substance_painter.export.export_project_textures( config )


def start_plugin():
	# Create a text widget for a menu
	Action = QtWidgets.QAction("Custom Python Export", 
								triggered=export_textures)

	# Add this widget to the existing File menu of the application
	substance_painter.ui.add_action(
		substance_painter.ui.ApplicationMenu.File,
		Action )

	# Store the widget for proper cleanup later when stopping the plugin
	plugin_widgets.append(Action)


def close_plugin():
	# Remove all widgets that have been added from the UI
	for widget in plugin_widgets:
		substance_painter.ui.delete_ui_element(widget)

	plugin_widgets.clear()


if __name__ == "__main__":
	start_plugin()
```